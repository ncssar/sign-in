# #############################################################################
#
#  main.kv - Kivy-Language GUI definition for sign-in app
#
#  sign-in is developed for Nevada County Sheriff's Search and Rescue
#    Copyright (c) 2019 Tom Grundy
#
#   sign-in (c) 2019 Tom Grundy, using kivy and buildozer
#
#  http://github.com/ncssar/sign-in
#
#  Contact the author at nccaves@yahoo.com
#   Attribution, feedback, bug reports and feature requests are appreciated
#
# see main.py for revision history
#
# #############################################################################

#:import Window kivy.core.window.Window
#:import DatePicker datepicker
#:import TimePicker timepicker

<MyButton@Button>:
    text: 'My Key'
    font_size: min(self.height*app.defaultTextHeightMultiplier,self.parent.parent.height*0.05)
    halign:'center'
    valign:'middle'
    on_press: app.keyDown(self.text)

<MyRV@RecycleView>:
    viewclass: 'Label'
    RecycleGridLayout:
        cols: 1
        default_size: None, dp(26)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<YesNoSwitch@Switch>:
    canvas:
        Color:
            rgb: 1,1,1
        Rectangle:
            source: 'images/switch.jpg'
            size: sp(83),sp(32)
            pos: int(self.center_x-sp(41)),int(self.center_y-sp(16))
        Rectangle:
            source: 'images/switch_slider.jpg' # make or download your slider jpg
            size: sp(43), sp(32)
            pos: int(self.center_x - sp(41) + self.active_norm_pos * sp(41)), int(self.center_y - sp(16))
            
# <KeypadButton@Button>:
#     id: keypadbutton
#     size_hint: None, None
#     height:'64sp'
#     width:'64sp'
#     pos: int(self.center_x - sp(64) + self.active_norm_pos * sp(64)), int(self.center_y - sp(32))
#     background_normal: 'images/keypad_64x64_white.png'
#     on_press:app.switchToBlankKeypad()     

<KeypadButton@Button>:
    id: keypadbutton
    on_press:app.switchToBlankKeypad()
    size_hint:None,1
    height: self.parent.height
    background_color:0,0,0,1
    Image:
        source: 'images/keypad_64x64_white.png'
        center_x: self.parent.center_x
        center_y: self.parent.center_y
    
<ListButton@Button>:
    size_hint: None, None
    height:64
    width:64
    background_normal: 'images/list_64x64_white.png'
    on_press:app.showList()

<DetailsButton@Button>:
    size_hint: None, None
    height:64
    width:64
    background_normal: 'images/gear_white.png'
    on_press:app.showDetails()

<SelectableLabel>:
    bg: 0,0,0,0
    canvas.before:
        Color:
            rgba: (0,0.9,0.1,0.3) if self.selected else self.bg
        Rectangle:
            pos: self.pos
            size: self.size
            
<ClockText>:

<KeypadScreen>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            height:20
            Label:
                id: headerLabel
                font_size: self.height*0.2
                text: ''
            Label:
                size_hint_x: 0.8
            ClockText:
                id: clocktext
                font_size: self.height*0.4
#             Label:
#                 size_hint_x: 0.8
            ListButton:
                id: listbutton
            DetailsButton:
                id: detailsbutton

        Label:
            id: topLabel
            markup: True
            halign: "center"
            valign: "middle"
        MyButton:
            id: nameButton
            background_normal:''
        Label:
            id: bottomLabel
            font_size: self.parent.height*0.05
#         Label:
#             text: 'Keep typing.  Tap your name when you see it.'
        BoxLayout:
            orientation: 'horizontal'
            MyButton:
                text: '1'
            MyButton:
                text: '2'
            MyButton:
                text: '3'
        BoxLayout:
            orientation: 'horizontal'
            MyButton:
                text: '4'
            MyButton:
                text: '5'
            MyButton:
                text: '6'
        BoxLayout:
            orientation: 'horizontal'
            MyButton:
                text: '7'
            MyButton:
                text: '8'
            MyButton:
                text: '9'
        BoxLayout:
            orientation: 'horizontal'
            MyButton:
                text: 'lu'
                color: (0,0,0,0)
                Image:
                    source: 'images/lookup_white.png'
                    x: self.parent.x + (self.parent.width/2) - (self.width/2)
                    y: self.parent.y
                    height: self.parent.height
            MyButton:
                text: '0'
            MyButton:
                text: 'bs'
                color: (0,0,0,0)
                Image:
                    source: 'images/backspace_white.png'
                    x: self.parent.x + (self.parent.width/2) - (self.width/2)
                    y: self.parent.y
                    height: self.parent.height
        Label:
            size_hint: None,None
            height: 5
        BoxLayout:
            orientation: 'horizontal'
            MyButton:
                text: 'T'
            MyButton:
                text: 'S'
            MyButton:
                text: 'E'
            MyButton:
                text: 'P'
            MyButton:
                text: 'D'
            MyButton:
                text: 'V'        
                       
<SignInScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: nameLabel
            font_size:self.height*app.defaultTextHeightMultiplier
        Label:
            id: idLabel
            font_size:self.height*app.defaultTextHeightMultiplier*2/3
        Label:
            id: statusLabel
            font_size:self.height*app.defaultTextHeightMultiplier*1/2
        Label:
            id: certHeader
            font_size:self.height*app.defaultTextHeightMultiplier*1/2
            text: "Are you available to deploy as:"
        BoxLayout: # to be filled by relevant certifications at runtime
            id: certBox
            orientation: 'vertical'
#         BoxLayout:
#             orientation: 'horizontal'
#             Label:
#                 text:'Ready to deploy as K9(Area)?'
#             Switch:
#                 canvas:
#                     Color:
#                         rgb: 1,1,1
#                     Rectangle:
#                         source: 'images/switch.jpg'
#                         size: sp(83),sp(32)
#                         pos: int(self.center_x-sp(41)),int(self.center_y-sp(16))
#                     Rectangle:
#                         source: 'images/switch_slider.jpg' # make or download your slider jpg
#                         size: sp(43), sp(32)
#                         pos: int(self.center_x - sp(41) + self.active_norm_pos * sp(41)), int(self.center_y - sp(16))
#         BoxLayout:
#             orientation: 'horizontal'
#             Label:
#                 text:'Ready to deploy as Nordic(ski)?'
#             Switch:
        MyButton:
            text: 'Sign In Now'
        MyButton:
            text: 'Sign In 30min Ago'
            opacity: 0.2
        MyButton:
            text: 'Sign In 60min Ago'
            opacity: 0.2
        MyButton:
            text: 'Back'

# <SignInTypeScreen>:
#     BoxLayout:
#         orientation: 'vertical'
#         Label:
#             id: nameLabel
#             font_size:36
#         Label:
#             id: idLabel
#             font_size:24
#         Label:
#             text: 'What resource type(s) are you ready to deploy as (in addition to Ground)?'
#         RecycleView:
#             viewclass: 'SelectableLabel'
#             data: [{'text':str(x)} for x in ["K9 (Area)","K9 (Trailing)","Mounted","Nordic (Ski)"]]
#             SelectableRecycleGridLayout:
#                 cols: 1
#                 size_hint_y: None
#                 default_size: None, dp(26)
#                 default_size_hint: 1, None
#                 size_hint_y: None
#                 height: self.minimum_height
#                 orientation: 'vertical'
#                 multiselect: False
              
<SignOutScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: nameLabel
            font_size:self.height*app.defaultTextHeightMultiplier
        Label:
            id: idLabel
            font_size:self.height*app.defaultTextHeightMultiplier*2/3
        Label:
            id: statusLabel
            font_size:self.height*app.defaultTextHeightMultiplier*1/2
            halign:'center'
        MyButton:
            text: 'Sign Out Now'
            font_size:self.parent.parent.height*1/20
        MyButton:
            text: 'Sign Out 30min From Now'
            font_size:self.parent.parent.height*1/50
            opacity: 0.2
        MyButton:
            text: 'Sign Out 60min From Now'
            font_size:self.parent.parent.height*1/50
            opacity: 0.2
        MyButton:
            font_size:self.parent.parent.height*1/20
            text: 'Back'
            
<AlreadySignedOutScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: nameLabel
            font_size:self.height*app.defaultTextHeightMultiplier
        Label:
            id: idLabel
            font_size:self.height*app.defaultTextHeightMultiplier*2/3
        Label:
            id: statusLabel
            font_size:self.height*app.defaultTextHeightMultiplier*1/3
            halign:'center'
            text_size:self.width,self.height # enable word wrap
        Button:
            text: 'That must be a mistake; change my latest sign-out time to right now.'
            font_size: min(self.height*app.defaultTextHeightMultiplier,self.parent.parent.height*0.04)
            halign:'center'
            valign:'middle'
            on_press: app.keyDown(self.text)
            text_size:self.width,self.height # enable word wrap
        MyButton:
            text: 'Sign In Again'
        MyButton:
            text: 'Back'
            
<ThankyouScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            font_size: self.height*app.defaultTextHeightMultiplier*1/3
            text: 'Thank You'
        Label:
#             height:self.parent.height*0.1
            id: nameLabel
#             font_size: self.height*app.defaultTextHeightMultiplier*1/2
            font_size: self.parent.parent.height*0.1
        Label:
            id: idLabel
            font_size:self.height*app.defaultTextHeightMultiplier*1/3
        Label:
            id: statusLabel
            font_size: self.height*app.defaultTextHeightMultiplier*1/4
            
<ListScreen>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: 0.1
            Label:
                id: listHeadingLabel
            KeypadButton:
            DetailsButton:
        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: 'horizontal'
            Label:
                text: 'ID'
            Label:
                text: 'Name'
            Label:
                text: 'Agency'
            Label:
                text: 'Resource'
            Label:
                text: 'In'
            Label:
                text: 'Out'
            Label:
                text: 'Total'
        BoxLayout:
            size_hint_y: 0.9
            RecycleView:
                viewclass: 'SelectableLabel'
                id: theGrid
                data: [{'text':str(x),'bg':(0,0,0,0)} for x in root.bigList]
                SelectableRecycleGridLayout:
                    id: theGridLayout
                    cols: 7
                    size_hint_y: None
                    default_size: None, dp(32)
                    default_size_hint: 1, None
                    height: self.minimum_height
                    orientation: 'vertical'
                    multiselect: False
                
<LookupScreen>:
    BoxLayout:
        orientation:'vertical'
        BoxLayout:
#             height:'64sp'
            size_hint_y:0.12
            Label:
#                 size_hint_y:0.1
                text: 'Start typing your last name;\ntap your name when you see it.'
                text_size:self.width,self.height
                font_size:self.height*app.defaultTextHeightMultiplier*1/3
                halign:'center'
                valign:'middle'
            KeypadButton:
        ComboEdit:
            id:combo
            size_hint_y:0.08
            font_size:self.height*0.6
        Label:
            size_hint_y:0.8 # placeholder to keep the comboedit textinput small
                
<DetailsScreen>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: 50
            Label:
                id: detailsHeadingLabel
            ListButton:
            KeypadButton:
        BoxLayout:
            size_hint_y: None
            height: 50
            Label:
                text: 'Event Type:'
            Label:
                text: 'Meeting'
                halign: 'right'
            CheckBox:
                id: meetingCheckBox
                group: 'group'
                on_active: root.eventType='Meeting'
            Label:
                text: 'Training'
                halign: 'right'
            CheckBox:
                id: trainingCheckBox
                group: 'group'
                on_active: root.eventType='Training'
            Label:
                text: 'Search'
                halign: 'right'
            CheckBox:
                id: searchCheckBox
                group: 'group'
                on_active: root.eventType='Search'
            Label:
                text: 'Other'
                halign: 'right'
            CheckBox:
                id: otherCheckBox
                group: 'group'
                on_active: root.eventType='Other'
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Event Name:'
            TextInput:
                multiline: False
                id: eventNameField
                on_text: root.eventName=self.text
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Event Location:'
            TextInput:
                multiline: False
                id: eventLocationField
                on_text: root.eventLocation=self.text
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Event Start Date:'
            DatePicker:
                id: eventStartDate
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Event Start Time:'
            TimePicker:
                id: eventStartTime
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Auto-export on every entry?'
            YesNoSwitch:
                id: autoExport
        Label:
            size_hint: None,None
            height: 10
        Label:
            size_hint_y: None
            height: 40
            text: 'No roster file has been loaded.'
            id: rosterStatusLabel
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Roster Filename:'
            TextInput:
                multiline: False
                id: rosterFileNameField
                text: root.rosterFileName
                on_text: root.rosterFileName=self.text
        BoxLayout:
            size_hint_y: None
            height: 40
            Label:
                text: 'Roster File Time:'
            Label:
                id: rosterTimeLabel
            Button:
                text: 'Reload'
                on_press: app.readRoster()
        Label:
            size_hint: None,None
            height: 10
        Button:
            text: 'Finalize & Export (PDF & CSV)'
            on_release: app.finalize()
        Button:
            text: 'Export (PDF & CSV)'
            on_release: app.export()
        Button:
            text: 'Read CSV'
            on_release: app.readCSV()
        Button:
            text: 'Re-sync'
            on_release: app.sync()
        Label:
            size_hint_y:0.8   
